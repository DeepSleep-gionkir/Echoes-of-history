## **[Part 3] 내부 정치와 만능 엔티티 (Internal Politics)**

이 파트는 게임의 '깊이'를 담당합니다. 수십 개의 서로 다른 시스템(파벌, 종교, 기업, 부대)을 **단 하나의 데이터 구조(만능 엔티티)**로 통합하여 관리하는 **[1인 개발 최적화 설계]**입니다.

---

### **3.1. 만능 엔티티 시스템 (Universal Entity System)**

모든 내부 세력을 **"태그(Tag)가 붙은 객체"**로 취급합니다. 코드는 태그를 보고 판단합니다.

**1) 데이터베이스 스키마 (`internal_entities`)**

```sql
CREATE TABLE internal_entities (
  id UUID PRIMARY KEY,
  nation_id UUID REFERENCES users(id),
  name TEXT,             -- 예: "동인도 회사", "제1 근위대"
  type TEXT,             -- 'faction', 'religion', 'corp', 'military'
  power INT DEFAULT 0,   -- 영향력 (0~100)
  loyalty INT DEFAULT 50,-- 충성도 (0~100, 0이면 반란)
  tags JSONB,            -- ["greedy", "rich", "foreign"]
  modifiers JSONB        -- {"tax_income": 1.2, "stability": -10} (보유 효과)
);
```

**2) 태그(Tag) 기반 행동 로직 (핵심!)**
개별 클래스를 만들지 않고, 태그에 따라 반응하게 코딩합니다.

- **`greedy` (탐욕):** 플레이어의 골드가 많으면 보너스를 요구함.
- **`fanatic` (광신):** 타 종교 국가와 동맹을 맺으면 충성도 급락.
- **`warlike` (호전):** 평화 상태가 길어지면 충성도 하락.

---

### **3.2. 파벌 (Factions): 줄타기 정치**

왕(플레이어)의 권력을 견제하는 4대 기본 파벌입니다.

**1) 파벌 종류와 태그**

- **귀족파 (Nobility):** `['conservative', 'warlike']` - 전쟁 선호, 개혁 반대.
- **상인파 (Merchants):** `['greedy', 'trade']` - 세금 인상 반대, 무역 선호.
- **사제파 (Clergy):** `['religious', 'conservative']` - 기술 발전 반대, 타 종교 배척.
- **민중파 (Commoners):** `['populist', 'poor']` - 식량/복지 중시.

**2) 상호작용 로직 (Tug-of-War)**
플레이어의 행동(Action)이 각 파벌의 충성도를 변화시킵니다.

- _Action:_ **[전쟁 선포]**
- _Code:_
  - 귀족파(`warlike`): 충성도 **▲10** ("명예로운 결정입니다!")
  - 상인파(`trade`): 충성도 **▼10** ("무역로가 끊깁니다!")
  - 민중파(`poor`): 충성도 **▼5** ("또 징병입니까?")

---

### **3.3. 종교 (Religion): 전염되는 이념**

종교는 플레이어가 컨트롤할 수 없는 **자연재해(바이러스)**처럼 설계합니다.

**1) 전파 메커니즘 (Cellular Automata)**

- Hex 타일마다 `religion_id` 속성이 있습니다.
- 매 턴(Turn)마다 확률적으로 인접 타일로 종교가 전파됩니다.
- **무역로 효과:** 무역 협정을 맺은 국가끼리는 전파 속도가 2배 빨라집니다.

**2) 효과와 갈등**

- **내부 갈등:** 내 영토 안에 **서로 다른 종교**가 섞여 있으면 `안정도(Stability)`가 지속적으로 하락합니다.
- **성전(Holy War):** 옆 나라가 나의 국교와 다른 종교를 믿는다면, 전쟁 선포 시 **[성전] 명분**을 사용하여 '권위' 소모 없이 공격할 수 있습니다.

**3) AI 활용 (생성 시 1회)**

- 종교가 처음 탄생할 때만 AI를 호출해 **이름과 교리**를 만듭니다.
  - _생성:_ "이름: 태양교, 교리: 사막 지형에서 전투력 +10%"

---

### **3.4. 기업과 군대 (Corporations & Military)**

**1) 기업 (The Sponsor)**

- 기술 발전(산업 시대) 시 등장합니다.
- **기능:** 플레이어에게 매 턴 **골드**를 줍니다. 대신 **정치적 요구(Lobbying)**를 합니다.
  - _요구:_ "옆 나라 A와의 전쟁을 멈추지 마십시오. 무기를 더 팔아야 합니다." (거절 시 골드 지원 중단)

**2) 군대 (Named Regiments)**

- 단순 숫자가 아닌 '이름 있는 부대'입니다.
- **`Elite` 태그:** 전투를 많이 치러 레벨업한 부대. 전투력은 세지만 **유지비가 비쌉니다.**
- **반란의 주축:** 충성도가 낮은 상태에서 장군이 야심(`ambitious` 태그)을 가지면, 해당 부대 전체가 적으로 돌변하여 수도로 진격합니다.

---

### **3.5. 비용 절감 구현: "침묵과 폭발"**

이 모든 상호작용을 AI에게 맡기면 비용이 감당 안 됩니다. **철저한 하이브리드 전략**을 씁니다.

**1) 일상적인 투덜거림 (템플릿)**

- 상황: 상인파 충성도가 50 -> 40으로 떨어짐.
- **UI 로그:** `[상인파]가 [세금 인상]에 불만을 가집니다.` (단어 치환, 비용 0원)

**2) 임계점 돌파 (AI 호출)**

- 상황: 상인파 충성도가 **10 미만**으로 떨어짐 -> **[파업/반란] 트리거.**
- **Server Logic:**
  - Gemini API 호출: `{"context": "merchant_rebellion", "reason": "high_tax"}`
- **AI Output:**
  > **[🚨 긴급 사태: 시장 폐쇄]** > **"탐욕스러운 왕이여! 우리 지갑을 털어가려거든 내 시체부터 넘어가라! 오늘부터 모든 상점은 문을 닫는다!"**
  >
  > - 효과: 골드 수입 0원으로 변경.

---

### **3.6. 개발 체크리스트 (To-Do)**

- [ ] **DB Table:** `internal_entities` 테이블 생성 및 `tags` 컬럼(JSONB) 설정.
- [ ] **Tag Logic:** `checkLoyaltyChange(action, tags)` 함수 구현 (태그별 충성도 증감 규칙 코딩).
- [ ] **Propagation:** `spreadReligion()` 함수 구현 (매 턴 인접 타일 감염 로직).
- [ ] **Template Data:** `templates.js` 파일에 "불만 표출", "지지 선언" 등 기본 문구 50개 작성.

---
